{% extends ext %}

{% block title %}
    {{ title }}
{% endblock %}

{% block main %}
<div class="container">
    <h3 class="color-dark">{{ title }}</h3>
    {% if length == 0 %}
        <h6 class="text-body-secondary my-4">There are no movies.</h6>
    {% else %}
        <div class="border container cont-6 rounded shadow mb-5">
            <h5 class="color-light">Sort By</h5>
            <select class="form-select" id="select-link">
                {% if sort_by == 2 %}
                    <option value="{{ url_for(url, sort_by=2) }}">Descending Date</option>
                    <option value="{{ url_for(url, sort_by=1) }}">Alphabetical Order</option>
                {% else %}
                    <option value="{{ url_for(url, sort_by=1) }}">Alphabetical Order</option>
                    <option value="{{ url_for(url, sort_by=2) }}">Descending Date</option>
                {% endif %}
            </select>
        </div>

        <!-- Activate/Inactivate Movies -->
        {% if title == 'All Movies' %} 
        <div class="conatainer mb-5 mt-0">
            <!-- Buttons for Modals -->
            <button type="button" class="btn btn-primary mb-2" data-bs-toggle="modal" data-bs-target="#activate-movie">
                Activate Movie
            </button>
            <button type="button" class="btn btn-primary mb-2" data-bs-toggle="modal" data-bs-target="#inactivate-movie">
                Inactivate Movie
            </button>
            
            <!-- Modals -->
            <div class="modal fade" id="activate-movie" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="staticBackdropLabel">Activate Movie</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p class="left-align text-body-secondary">Only movies with a release date, poster, backdrop, and trailer can be activated.</p>
                            <form action="" method="POST" id="activate" class="needs-validation" novalidate>
                                {{ activate_form.hidden_tag() }}
                                <div class="form-floating">
                                    {{ activate_form.m_id(class="form-select") }}
                                    {{ activate_form.m_id.label }}
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            {% if activate_form.m_id.choices | length > 1 %}
                                {{ activate_form.submit(class="btn btn-primary", form="activate") }}
                            {% else %}
                                {{ activate_form.submit(class="btn btn-primary", disabled=True) }}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="inactivate-movie" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="staticBackdropLabel">Inactivate Movie</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p class="left-align text-body-secondary">Only movies with no upcoming showtimes can be inactivated.</p>
                            <form action="" method="POST" id="inactivate" class="needs-validation" novalidate>
                                {{ inactivate_form.hidden_tag() }}
                                <div class="form-floating">
                                    {{ inactivate_form.m_id(class="form-select") }}
                                    {{ inactivate_form.m_id.label }}
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            {% if inactivate_form.m_id.choices | length > 1 %}
                                {{ inactivate_form.submit(class="btn btn-primary", form="inactivate") }}
                            {% else %}
                                {{ inactivate_form.submit(class="btn btn-primary", disabled=True) }}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

        </div>
        {% endif %}

        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4 cont-light rounded">
            {% for movie in movies %}
                <div class="col pb-4">
                    <div class="card">
                        <a href="{{ url_for('employees.movies.movie', movie_route=movie.route) }}" class="movie-link">
                            <img src="https://image.tmdb.org/t/p/original{{movie['poster_path']}}" class="card-img-top" alt="Poster for {{movie['title']}}">
                        </a>
                        <div class="card-body">
                            <span class="my-tooltip" data-bs-toggle="tooltip" title="{{movie.title}}">
                                <h6 class="card-title text-truncate">{{ movie.title }}</h6><br>
                            </span>
                            
                            <p class="card-text"><small>
                                <b>{{ movie.status }}</b><br>
                                {% if movie.release_date %}
                                    <b>Release Date:</b> {{ movie.release_date.strftime("%b %d, %Y") }}<br>
                                {% else %}
                                    <b>Release Date:</b> N/A<br>
                                {% endif %}
                            
                                {% if movie.rating %}
                                    <b>Rated:</b> {{ movie.rating }}<br>
                                {% endif %}
                            </small></p></br>
                            
                            <p class="card-text"><small class="text-body-secondary">
                                {% for genre in movie.genres %}
                                        {{ genre.name }},
                                {% endfor %}
                            </small></p>
                        </div>

                        <small class="text-body-secondary">
                            <div class="btn-group action" role="group">
                                <button id="action" type="button" class="btn btn-other btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                    Action
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="movie-action">
                                    <li><a href="{{ url_for('employees.movies.movie', movie_route=movie.route) }}" class="dropdown-item">Info</a></li>
                                    <li><a href="{{ url_for('employees.movies.update_movie', movie_route=movie.route) }}" class="dropdown-item">Update</a></li>
                                    <li><a href="{{ url_for('employees.showtimes.movie', movie_route=movie.route) }}" class="dropdown-item">Showtimes</a></li>
                                </ul>
                            </div>

                            {% if movie.active %}
                                <div class="card-footer text-white green">
                                    Active
                                </div>
                            {% else %}
                                <div class="card-footer text-white red">
                                    Inactive
                                </div>
                            {% endif %}
                        </small>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <div class="my-5">
            {% for pg_num in movies.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                    {% if pg_num %}
                        {% if movies.page == pg_num %}
                            <a class="page-current me-3" href="{{ url_for(url, page=pg_num, sort_by=sort_by) }}">{{ pg_num }}</a>
                        {% else %}
                            <a class="page me-3" href="{{ url_for(url, page=pg_num, sort_by=sort_by) }}">{{ pg_num }}</a>
                        {% endif %}
                    {% else %}
                        <span class="me-3">...</span>
                    {% endif %}
            {% endfor %}
        </div>

    </div>
    {% endif %}

{% endblock %}

